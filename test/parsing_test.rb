require 'circuit_logic'

module CircuitLogic
  class TestParser < Test::Unit::TestCase
    class LightMock < Struct.new(:on)
      def on?
        on
      end
      
      def ==(other)
        on? == other.on?
      end
    end
    
    def setup
      @on  = LightMock.new true
      @off = LightMock.new false
    end
  
    def assert_parses_to(expected, string)
      assert_equal expected, Parser.parse(string)
    end
    
    def test_one_line_off
      assert_parses_to [@off], "0-------@"
    end
  
    def test_one_line_on
      assert_parses_to [@on], "1-------@"
    end
  
    def test_simple_1
      assert_parses_to [@on], <<-CIRCUIT
        0-------------|
                      |
                      O-----------@
        1-------------|
      CIRCUIT
    end
  
    def test_simple_2
      assert_parses_to [@off], <<-CIRCUIT
        0-------------|
                      A------------|
        1-------------|            |
                                   X------------@
        1-------------|            |
                      N------------|
      CIRCUIT
    end
      
    def test_simple_3
      assert_parses_to [@on], <<-CIRCUIT
        0-------------|
                      O------------|
        1-------------|            |
                                   X------------@
        1-------------|            |
                      X------------|
        1-------------|
      CIRCUIT
    end
    
    def test_two_lights
      assert_parses_to [@on, @off], <<-CIRCUIT
        1---@
        
        0---@
      CIRCUIT
    end
      
    def test_complex
      assert_parses_to [@on, @on, @on, @off], <<-CIRCUIT
        0-------------|
                      O------------|
        1-------------|            |
                                   X--------------------|
        1-------------|            |                    |
                      A------------|                    |
        1-------------|                                 O--------------------|
                                                        |                    |
        0-------------|                                 |                    |
                      N---------------------------------|                    |
                                                                             |
        0-------------|                                                      |
                      O------------|                                         A------------@
        1-------------|            |                                         |
                                   X--------------------|                    |
        1-------------|            |                    |                    |
                      A------------|                    |                    |
        1-------------|                                 O--------------------|
                                                        |
        0-------------|                                 |
                      N---------------------------------|
    
        0-------------|
                      X------------|
        1-------------|            |
                                   N--------------------|
                                                        |
                                                        |
                                                        O--------------------|
                                                        |                    |
        0-------------|                                 |                    |
                      N---------------------------------|                    |
                                                                             |
        0-------------|                                                      |
                      A------------|                                         O------------@
        1-------------|            |                                         |
                                   X--------------------|                    |
        1-------------|            |                    |                    |
                      O------------|                    |                    |
        1-------------|                                 A--------------------|
                                                        |
        0-------------|                                 |
                      X---------------------------------|
        1-------------|
    
        1--------------|
                       O-----------------|
        1--------------|                 N----------------|
                                                          |
        1--------------|                                  |
                       O-----------------|                O------------|
        0--------------|                 |                |            |
                                         A----------------|            |
                       0-----------------|                             X--------------------|
                                                                       |                    |
                                                                       |                    |
        0--------------|                                               |                    |
                       A-----------------|                             |                    |
        1--------------|                 O----------------|            |                    |
                                         |                |            |                    |
        1--------------|                 |                |            |                    |
                       X-----------------|                |            |                    |
        0--------------|                                  A------------|                    |
                                                          |                                 |
        1--------------|                                  |                                 |
                       A-----------------|                |                                 |
        0--------------|                 |                |                                 |
                                         X----------------|                                 O--------------------|
        1--------------|                 |                                                  |                    |
                       O-----------------|                                                  |                    |
        0--------------|                                                                    |                    |
                                                                                            |                    |
        1--------------|                                                                    |                    |
                       X-----------------|                                                  |                    |
        1--------------|                 |                                                  |                    |
                                         |                                                  |                    |
                                         A----------------|                                 |                    |
        1--------------|                 |                N---------------------------------|                    |
                       O-----------------|                                                                       |
        0--------------|                                                                                         |
                                                                                                                 |
                                                                                                                 |
                       1----------------|                                                                        |
                                        A-----------------|                                                      |
                       0----------------|                 |                                                      |
                                                          |                                                      |
                                                          |                                                      |
        0---------------|                                 |                                                      |
                        A---------------|                 O------------|                                         A----------------@
        1---------------|               N-----------------|            |                                         |
                                                                       X--------------------|                    |
                                                                       |                    |                    |
        1---------------|                                              |                    |                    |
                        X---------------|                              |                    |                    |
        0---------------|               |                              |                    |                    |
                                        O-----------------|            |                    |                    |
        0---------------|               |                 |            |                    |                    |
                        O---------------|                 |            |                    |                    |
        1---------------|                                 |            |                    |                    |
                                                          A------------|                    |                    |
                                                          |                                 |                    |
                                        1-----------------|                                 O--------------------|
        1---------------|                                                                   |
                        A---------------|                                                   |
        1---------------|               N-----------------|                                 |
                                                          N---------------------------------|
    
        1--------------|
                       O-----------------|
        1--------------|                 N----------------|
                                                          |
                                                          |
                       1-----------------|                O------------|
                                         A----------------|            |
                       0-----------------|                             X--------------------|
                                                                       |                    |
                                                                       |                    |
        0--------------|                                               |                    |
                       A-----------------|                             |                    |
        1--------------|                 A----------------|            |                    |
                                         |                |            |                    |
        1--------------|                 |                |            |                    |
                       X-----------------|                |            |                    |
        0--------------|                                  X------------|                    |
                                                          |                                 |
        1--------------|                                  |                                 |
                       A-----------------|                |                                 |
        0--------------|                 |                |                                 |
                                         X----------------|                                 O--------------------|
        1--------------|                 |                                                  |                    |
                       A-----------------|                                                  |                    |
        0--------------|                                                                    |                    |
                                                                                            |                    |
        1--------------|                                                                    |                    |
                       X-----------------|                                                  |                    |
        1--------------|                 |                                                  |                    |
                                         |                                                  |                    |
                                         A----------------|                                 |                    |
        1--------------|                 |                N---------------------------------|                    |
                       A-----------------|                                                                       |
        0--------------|                                                                                         |
                                                                                                                 |
        0--------------|                                                                                         |
                       A----------------|                                                                        |
        1--------------|                O-----------------|                                                      |
                                        |                 |                                                      |
                       0----------------|                 |                                                      |
                                                          |                                                      |
                                                          |                                                      |
        0---------------|                                 |                                                      |
                        A---------------|                 X------------|                                         A----------------@
        1---------------|               X-----------------|            |                                         |
                                        |                              |                                         |
        1---------------|               |                              |                                         |
                        N---------------|                              A--------------------|                    |
                                                                       |                    |                    |
        1---------------|                                              |                    |                    |
                        X---------------|                              |                    |                    |
        0---------------|               |                              |                    |                    |
                                        O-----------------|            |                    |                    |
        0---------------|               |                 |            |                    |                    |
                        O---------------|                 |            |                    |                    |
        1---------------|                                 |            |                    |                    |
                                                          O------------|                    |                    |
                                                          |                                 |                    |
                                        1-----------------|                                 A--------------------|
        1---------------|                                                                   |
                        A---------------|                                                   |
        1---------------|               N-----------------|                                 |
                                                          A---------------------------------|
        1---------------|                                 |
                        A---------------|                 |
        0---------------|               |                 |
                                        O-----------------|
        1---------------|               |
                        N---------------|
      CIRCUIT
    end
  end
end
